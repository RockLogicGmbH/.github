name: Trigger label sync in all repos

on:
  push:
    paths:
      - '.github/labels.yml'   # only when the label config changes

jobs:
  dispatch:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger sync-labels workflow in all repos
        env:
          ORG: RockLogicGmbH
          TOKEN: ${{ secrets.ORG_TRIGGER_PAT }}
        run: |
          # List of repos that should sync labels
          REPOS=(
            "test"
            # "repo-2"
            # "another-repo"
          )

          WORKFLOW_FILE="sync-labels.yml"
          REF="main"   # branch to run on in target repos

          for REPO in "${REPOS[@]}"; do
            echo "Triggering $WORKFLOW_FILE in $ORG/$REPO..."

            curl -s -X POST \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer $TOKEN" \
              https://api.github.com/repos/$ORG/$REPO/actions/workflows/$WORKFLOW_FILE/dispatches \
              -d "{\"ref\":\"$REF\"}" \
              || echo "Failed to trigger for $ORG/$REPO"
          done
